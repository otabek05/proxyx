version: 2
project_name: proxyx

builds:
  - id: proxyx
    main: ./cmd/proxyx/main.go
    binary: proxyx
    goos:
      - linux
      - darwin
    goarch:
      - amd64
      - arm64
    env:
      - CGO_ENABLED=0

nfpms:
  - id: proxyx-linux
    package_name: proxyx
    builds:
      - proxyx
    formats:
      - deb
      - rpm

    maintainer: Otabek Toshmukhammedov <otabektoshmukhammedov@gmail.com>
    description: ProxyX Reverse Proxy Service
    license: MIT
    bindir: /usr/local/bin

    contents:
      - src: releaser/linux/systemd/proxyx.service
        dst: /etc/systemd/system/proxyx.service

      - src: web
        dst: /etc/proxyx/web

    scripts:
      preinstall: releaser/linux/scripts/preinstall.sh
      postinstall: releaser/linux/scripts/postinstall.sh
      preremove: releaser/linux/scripts/preremove.sh


brews:
  - name: proxyx
    ids:
      - proxyx
    url_template: "https://github.com/otabek05/proxyx/releases/download/{{ .Tag }}/{{ .ArtifactName }}"
    commit_msg_template: "Brew formula update for proxyx {{ .Tag }}"
    directory: Formula
    homepage: "https://github.com/otabek05/proxyx"
    description: "ProxyX Reverse Proxy Service"
    license: "MIT"
    install: |
      bin.install "proxyx"
      (etc/"proxyx").install Dir["web/*"]

    service: |
      run [opt_bin/"proxyx"]
      keep_alive true
      working_dir etc/"proxyx"
      log_path var/"log/proxyx.log"
      error_log_path var/"log/proxyx.error.log"

    test: |
      system "#{bin}/proxyx", "--version"

    repository:
      owner: otabek05
      name: homebrew-proxyx
      branch: main

    commit_author:
      name: goreleaserbot
      email: bot@goreleaser.com
